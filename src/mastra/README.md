# Mastra AI Integration

This directory contains the Mastra AI framework integration for Evening. Mastra provides agents, tools, and workflows for intelligent web scraping and data processing.

## Overview

Mastra is a TypeScript AI framework that enables building autonomous agents with tools, memory, and workflows. We're integrating it carefully to enhance Evening's scraping capabilities with AI-powered decision making.

## Directory Structure

```
src/mastra/
├── index.ts           # Mastra configuration and exports
├── tools/             # Custom tools for agents
│   └── typescript-to-zod.ts  # TypeScript interface → Zod schema generator
├── agents/            # AI agents (to be added)
└── workflows/         # Multi-step workflows (to be added)
```

## Getting Started

### 1. Core Dependencies (Already Installed)

- `@mastra/core` - Core Mastra framework
- `zod` - Schema validation

### 2. Optional: Install AI Provider SDKs

To use agents with AI models, install provider packages:

```bash
# For Google Gemini
bun add @ai-sdk/google

# For OpenAI-compatible APIs (Cerebras, Zhipu AI, etc.)
bun add @ai-sdk/openai
```

See `src/mastra/models.ts` for configuration examples.

### 3. Configure Environment

Copy `.env.example` to `.env` and add your AI provider API key:

```bash
cp .env.example .env
```

Available keys (you only need one):
- `GOOGLE_GENERATIVE_AI_API_KEY` - Google Gemini (free tier available)
- `CEREBRAS_API_KEY` - Cerebras (free tier available)
- `ZHIPU_AI_API_KEY` - Zhipu AI / ZAI GLM Coding Plan

### 4. Try the Examples

Run the Reddit schema generation example:

```bash
bun run src/mastra/examples/reddit-schema-example.ts
```

### 5. (Optional) Run Mastra Studio

Start the development studio to interact with tools and agents:

```bash
bun run mastra:dev
```

Access the studio at: http://localhost:4111

## Available Tools

### TypeScript to Zod Schema Generator

Converts TypeScript interfaces (like those generated by quicktype) into Zod schemas with intelligent validation based on sample data.

**Features:**
- Detects URLs and applies `.url()` validation
- Detects emails and applies `.email()` validation
- Detects UUIDs and applies `.uuid()` validation
- Detects ISO dates and applies `.datetime()` validation
- Distinguishes integers from floats
- Handles optional fields
- Supports nested objects and arrays

**Usage Example:**

```typescript
import { typescriptToZodTool } from './tools/typescript-to-zod';

const result = await typescriptToZodTool.execute({
  context: {
    interfaceString: `
      interface RedditPost {
        id: string;
        url: string;
        score: number;
      }
    `,
    sampleData: {
      id: "abc123",
      url: "https://reddit.com/r/programming/comments/abc123",
      score: 42
    }
  }
});

console.log(result.zodSchema);
// Generates:
// export const RedditPostSchema = z.object({
//   id: z.string(),
//   url: z.string().url(),
//   score: z.number().int()
// });
```

**Test it:**

```bash
bun run src/mastra/tools/typescript-to-zod.test.ts
```

## Examples

### Reddit Schema Generation

See `src/mastra/examples/reddit-schema-example.ts` for a practical example that generates Zod schemas for Reddit post and comment data. This demonstrates how to use the TypeScript-to-Zod tool with real-world data structures.

Run it:
```bash
bun run src/mastra/examples/reddit-schema-example.ts
```

This example shows:
- Generating schemas for complex interfaces
- Automatic URL detection in fields like `url`, `thumbnail`, `permalink`
- Integer detection for scores, counts, timestamps
- Handling optional fields
- Creating validation for scraped data

## Next Steps

As we build out the AI integration, we'll add:

1. **Agents** - Autonomous scrapers that make intelligent decisions
2. **Workflows** - Multi-step scraping orchestrations
3. **Memory** - Persistent context across scraping sessions
4. **RAG** - Knowledge base for scraping patterns and strategies

## Important Notes

⚠️ **Mastra can be delicate** - Changes should be tested thoroughly. Always:
- Run `bun run lint:fix` before committing
- Test tools with the test files before using in production
- Check Mastra's changelog for breaking changes when updating

## Resources

- [Mastra Documentation](https://mastra.ai/docs)
- [Mastra GitHub](https://github.com/mastra-ai/mastra)
- [Zod Documentation](https://zod.dev)
